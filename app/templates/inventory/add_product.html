{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="card" style="max-width: 900px; margin: 0 auto;">
        <h2 style="color: var(--secondary-color); margin-bottom: 25px; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px;">
            üÜï Cadastrar Novo Produto
        </h2>

        <form method="POST">
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label>Nome / Descri√ß√£o do Produto</label>
                    <input type="text" name="name" class="form-control" placeholder="Ex: Martelo de Unha 29mm" required>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>C√≥digo / EAN (Opcional)</label>
                    <input type="text" name="code" class="form-control" placeholder="Deixe vazio para auto-gerar">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>Pre√ßo de Custo (R$)</label>
                    <input type="number" step="0.01" id="cost_price" name="cost_price" class="form-control" value="0.00" oninput="calcMargin()">
                </div>
                <div class="form-group">
                    <label>Pre√ßo de Venda (R$)</label>
                    <input type="number" step="0.01" id="sale_price" name="price" class="form-control" value="0.00" oninput="calcMargin()">
                </div>
                <div class="form-group">
                    <label>Estoque Inicial</label>
                    <input type="number" name="stock" class="form-control" value="0" required>
                </div>
            </div>

            <div id="profit-panel" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: space-around; border-left: 5px solid var(--primary-color);">
                <div>
                    <small style="color: gray;">Lucro em Reais:</small>
                    <h4 id="profit-cash" style="margin:0; color: #27ae60;">R$ 0,00</h4>
                </div>
                <div>
                    <small style="color: gray;">Margem de Lucro:</small>
                    <h4 id="profit-percent" style="margin:0; color: #27ae60;">0%</h4>
                </div>
            </div>

            <div class="form-row" style="background: #eef2f7; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div class="form-group" style="flex: 1;">
                    <label>NCM (8 d√≠gitos)</label>
                    <input type="text" name="ncm" class="form-control" placeholder="00000000" maxlength="8">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>CFOP Padr√£o</label>
                    <input type="text" name="cfop" class="form-control" value="5102" maxlength="4">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Unidade</label>
                    <select name="unit" class="form-control">
                        <option value="UN">Unidade (UN)</option>
                        <option value="KG">Quilo (KG)</option>
                        <option value="MT">Metro (MT)</option>
                        <option value="LT">Litro (LT)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Categoria</label>
                <select name="category" class="form-control">
                    <option value="Ferragem">Ferragem</option>
                    <option value="Agropecu√°ria">Agropecu√°ria</option>
                    <option value="Sementes">Sementes</option>
                    <option value="Ferramentas">Ferramentas</option>
                </select>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button type="submit" class="btn-success" style="flex: 2;">Confirmar Cadastro</button>
                <a href="{{ url_for('inventory.list_products') }}" class="btn-theme" style="flex: 1; background: var(--secondary-color); text-decoration: none; text-align: center; padding: 12px;">Cancelar</a>
            </div>
        </form>
    </div>
</div>

<script>
function calcMargin() {
    const cost = parseFloat(document.getElementById('cost_price').value) || 0;
    const sale = parseFloat(document.getElementById('sale_price').value) || 0;
    const profitCash = sale - cost;
    const profitPercent = cost > 0 ? (profitCash / cost) * 100 : 0;
    document.getElementById('profit-cash').innerText = `R$ ${profitCash.toFixed(2)}`;
    document.getElementById('profit-percent').innerText = `${profitPercent.toFixed(1)}%`;
    const color = profitCash >= 0 ? '#27ae60' : '#e74c3c';
    document.getElementById('profit-cash').style.color = color;
    document.getElementById('profit-percent').style.color = color;
}
</script>
{% endblock %}