{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="card" style="max-width: 900px; margin: 40px auto; background: #1a1a1a; border: 1px solid #333; box-shadow: 0 15px 35px rgba(0,0,0,0.5);">
        <h2 style="color: #00ff88; margin-bottom: 30px; border-bottom: 2px solid #00ff88; padding-bottom: 15px; font-weight: 800; letter-spacing: 1px;">
            üÜï CADASTRAR PRODUTO
        </h2>

        <form method="POST">
            <div class="form-row" style="margin-bottom: 25px;">
                <div class="form-group" style="flex: 2; margin-right: 15px;">
                    <label style="color: #00ff88; font-weight: 600; display: block; margin-bottom: 8px;">Nome / Descri√ß√£o</label>
                    <input type="text" name="name" class="form-control" placeholder="Ex: Martelo de Unha 29mm" required
                           style="background: #2d2d2d; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px;">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label style="color: #00ff88; font-weight: 600; display: block; margin-bottom: 8px;">C√≥digo Interno / EAN</label>
                    <input type="text" name="code" class="form-control" placeholder="Auto-gerar se vazio"
                           style="background: #2d2d2d; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <div class="form-group">
                    <label style="color: #00ff88; font-weight: 600; display: block; margin-bottom: 8px;">Pre√ßo de Custo (R$)</label>
                    <input type="number" step="0.01" id="cost_price" name="cost_price" class="form-control" value="0.00" oninput="calcMargin()"
                           style="background: #2d2d2d; border: 1px solid #444; color: #ffcc00; padding: 12px; border-radius: 8px; font-weight: bold;">
                </div>
                <div class="form-group">
                    <label style="color: #00ff88; font-weight: 600; display: block; margin-bottom: 8px;">Pre√ßo de Venda (R$)</label>
                    <input type="number" step="0.01" id="sale_price" name="price" class="form-control" value="0.00" oninput="calcMargin()"
                           style="background: #2d2d2d; border: 1px solid #444; color: #00ff88; padding: 12px; border-radius: 8px; font-weight: bold;">
                </div>
                <div class="form-group">
                    <label style="color: #00ff88; font-weight: 600; display: block; margin-bottom: 8px;">Qtd. Inicial</label>
                    <input type="number" name="stock" class="form-control" value="0" required
                           style="background: #2d2d2d; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px;">
                </div>
            </div>

            <div id="profit-panel" style="background: #111; padding: 20px; border-radius: 12px; margin-bottom: 30px; display: flex; justify-content: space-around; border-left: 6px solid #00ff88; border-right: 1px solid #333; border-top: 1px solid #333; border-bottom: 1px solid #333;">
                <div style="text-align: center;">
                    <small style="color: #888; text-transform: uppercase; font-size: 10px; letter-spacing: 1px;">Lucro L√≠quido</small>
                    <h3 id="profit-cash" style="margin: 5px 0 0 0; color: #00ff88; font-weight: 800;">R$ 0,00</h3>
                </div>
                <div style="text-align: center; border-left: 1px solid #333; padding-left: 40px;">
                    <small style="color: #888; text-transform: uppercase; font-size: 10px; letter-spacing: 1px;">Margem Bruta</small>
                    <h3 id="profit-percent" style="margin: 5px 0 0 0; color: #00ff88; font-weight: 800;">0%</h3>
                </div>
            </div>

            <div style="background: #252525; padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 1px solid #333;">
                <h5 style="color: #888; font-size: 12px; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px;">Dados Fiscais e Classifica√ß√£o</h5>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label style="color: #aaa; font-size: 13px;">NCM (8 d√≠gitos)</label>
                        <input type="text" name="ncm" class="form-control" placeholder="00000000" maxlength="8"
                               style="background: #1a1a1a; border: 1px solid #444; color: #ddd; padding: 10px; border-radius: 6px;">
                    </div>
                    <div class="form-group">
                        <label style="color: #aaa; font-size: 13px;">CFOP Padr√£o</label>
                        <input type="text" name="cfop" class="form-control" value="5102" maxlength="4"
                               style="background: #1a1a1a; border: 1px solid #444; color: #ddd; padding: 10px; border-radius: 6px;">
                    </div>
                    <div class="form-group">
                        <label style="color: #aaa; font-size: 13px;">Unidade</label>
                        <select name="unit" class="form-control" style="background: #1a1a1a; border: 1px solid #444; color: #ddd; padding: 10px; border-radius: 6px; height: 42px;">
                            <option value="UN">Unidade (UN)</option>
                            <option value="KG">Quilo (KG)</option>
                            <option value="MT">Metro (MT)</option>
                            <option value="LT">Litro (LT)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label style="color: #aaa; font-size: 13px;">Categoria</label>
                    <select name="category" class="form-control" style="background: #1a1a1a; border: 1px solid #444; color: #ddd; padding: 10px; border-radius: 6px; height: 42px;">
                        <option value="Ferragem">Ferragem</option>
                        <option value="Agropecu√°ria">Agropecu√°ria</option>
                        <option value="Sementes">Sementes</option>
                        <option value="Ferramentas">Ferramentas</option>
                    </select>
                </div>
            </div>

            <div style="display: flex; gap: 15px;">
                <button type="submit" class="btn-success" style="flex: 2; padding: 15px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; border-radius: 10px; cursor: pointer;">
                    üíæ Confirmar Cadastro
                </button>
                <a href="{{ url_for('inventory.list_products') }}" class="btn-theme" 
                   style="flex: 1; background: #333; color: #fff; text-decoration: none; text-align: center; padding: 15px; border-radius: 10px; font-weight: bold; border: 1px solid #444;">
                    ‚ùå Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function calcMargin() {
    const cost = parseFloat(document.getElementById('cost_price').value) || 0;
    const sale = parseFloat(document.getElementById('sale_price').value) || 0;
    const profitCash = sale - cost;
    const profitPercent = cost > 0 ? (profitCash / cost) * 100 : 0;
    
    document.getElementById('profit-cash').innerText = `R$ ${profitCash.toFixed(2)}`;
    document.getElementById('profit-percent').innerText = `${profitPercent.toFixed(1)}%`;
    
    const color = profitCash >= 0 ? '#00ff88' : '#ff4444';
    document.getElementById('profit-cash').style.color = color;
    document.getElementById('profit-percent').style.color = color;
    document.getElementById('profit-panel').style.borderColor = color;
}
</script>
{% endblock %}